source config
{

    type          = mysql
    sql_host      = localhost
    sql_user      = username
    sql_pass      = password
    sql_db        = database
    sql_port      = 3306

    sql_query_pre = SET NAMES utf8
    sql_query_pre = SET CHARACTER SET utf8
    sql_query_pre = SET SESSION query_cache_type=OFF

}

source movie : config
{

    sql_query             = \
                            SELECT \
                                movie_kp_id, \
                                movie_kp_id AS kp_id, \
                                movie_year AS year, \
                                movie_title_ru AS title_ru, \
                                movie_title_en AS title_en, \
                                movie_pictures AS pictures, \
                                TO_DAYS(movie_premiere) AS premiere, \
                                IF(movie_title_ru != "", CONCAT(movie_title_ru, IF(movie_title_en != "", CONCAT(" / ", movie_title_en), "")), IF(movie_title_en != "", movie_title_en, "")) AS search, \
                                IF(movie_countries_full != "", movie_countries_full, (IF(movie_countries = "", "_empty", movie_countries))) AS country, \
                                IF(movie_directors_full != "", movie_directors_full, (IF(movie_directors = "", "_empty", movie_directors))) AS director, \
                                IF(movie_genres_full != "", movie_genres_full, (IF(movie_genres = "", "_empty", movie_genres))) AS genre, \
                                IF(movie_actors_full != "", movie_actors_full, (IF(movie_actors = "", "_empty", movie_actors))) AS actor, \
                                movie_description AS description, \
                                movie_kp_rating AS kp_rating, \
                                movie_kp_vote AS kp_vote, \
                                movie_imdb_rating AS imdb_rating, \
                                movie_imdb_vote AS imdb_vote, \
                                movie_type AS type, \
                                "_all_" AS all_movies \
                            FROM \
                                movies

    sql_attr_uint          = kp_id
    sql_attr_uint          = kp_rating
    sql_attr_uint          = kp_vote
    sql_attr_uint          = imdb_rating
    sql_attr_uint          = imdb_vote
    sql_attr_uint          = premiere
    sql_attr_uint          = type
    sql_attr_string        = title_ru
    sql_attr_string        = title_en
    sql_attr_string        = description
    sql_attr_string        = pictures
    sql_field_string       = search
    sql_field_string       = year
    sql_field_string       = country
    sql_field_string       = director
    sql_field_string       = genre
    sql_field_string       = actor

}

index movies
{

    source            = movie
    path              = /var/lib/sphinxsearch/data/movies
    docinfo           = extern
    morphology        = stem_enru
    html_strip        = 1
    min_word_len      = 2
    expand_keywords   = 1
    index_exact_words = 1

}

source best_movie : config
{

    sql_query             = \
                                SELECT \
                                    movie_kp_id, \
                                    movie_kp_id AS kp_id, \
                                    movie_year AS year, \
                                    movie_title_ru AS title_ru, \
                                    movie_title_en AS title_en, \
                                    movie_pictures AS pictures, \
                                    TO_DAYS(movie_premiere) AS premiere, \
                                    IF(movie_title_ru != "", CONCAT(movie_title_ru, IF(movie_title_en != "", CONCAT(" / ", movie_title_en), "")), IF(movie_title_en != "", movie_title_en, "")) AS search, \
                                    IF(movie_countries_full != "", movie_countries_full, (IF(movie_countries = "", "_empty", movie_countries))) AS country, \
                                    IF(movie_directors_full != "", movie_directors_full, (IF(movie_directors = "", "_empty", movie_directors))) AS director, \
                                    IF(movie_genres_full != "", movie_genres_full, (IF(movie_genres = "", "_empty", movie_genres))) AS genre, \
                                    IF(movie_actors_full != "", movie_actors_full, (IF(movie_actors = "", "_empty", movie_actors))) AS actor, \
                                    movie_description AS description, \
                                    movie_kp_rating AS kp_rating, \
                                    movie_kp_vote AS kp_vote, \
                                    movie_imdb_rating AS imdb_rating, \
                                    movie_imdb_vote AS imdb_vote, \
                                    movie_type AS type, \
                                    "_all_" AS all_movies \
                                FROM \
                                    movies \
                                ORDER BY \
                                    movie_kp_vote DESC \
                                LIMIT \
                                    10000

        sql_attr_uint          = kp_id
        sql_attr_uint          = kp_rating
        sql_attr_uint          = kp_vote
        sql_attr_uint          = imdb_rating
        sql_attr_uint          = imdb_vote
        sql_attr_uint          = premiere
        sql_attr_uint          = type
        sql_attr_string        = title_ru
        sql_attr_string        = title_en
        sql_attr_string        = description
        sql_attr_string        = pictures
        sql_field_string       = search
        sql_field_string       = year
        sql_field_string       = country
        sql_field_string       = director
        sql_field_string       = genre
        sql_field_string       = actor

}

index best_movies
{

    source            = best_movie
    path              = /var/lib/sphinxsearch/data/best_movies
    docinfo           = extern
    morphology        = stem_enru
    html_strip        = 1
    min_word_len      = 2
    expand_keywords   = 1
    index_exact_words = 1

}

indexer
{
    mem_limit             = 128M
    max_file_field_buffer = 32M
}

searchd
{

    listen            = 9312
    listen            = 9306:mysql41
    log               = /var/log/sphinxsearch/searchd.log
    query_log         = /var/log/sphinxsearch/query.log
    read_timeout      = 5
    max_children      = 30
    pid_file          = /var/run/sphinxsearch/searchd.pid
    seamless_rotate   = 1
    preopen_indexes   = 1
    unlink_old        = 1
    binlog_path       = /var/lib/sphinxsearch/data
    collation_server  = utf8_general_ci

}